# Direnv
eval "$(direnv hook zsh)"

# Antibody
if [ -e ~/.cache/zsh/.antibody.plugins ]; then
  source ~/.cache/zsh/.antibody.plugins
else
  mkdir -p ~/.cache/zsh
  antibody bundle < ~/.antibody.plugins > ~/.cache/zsh/.antibody.plugins
  source ~/.cache/zsh/.antibody.plugins
fi

# ASDF
source ~/.asdf/asdf.sh
source ~/.asdf/completions/asdf.bash

plugins_to_install=$(sort ~/.asdfrc.plugins)
installed_plugins=$(sort <(asdf plugin-list))
uninstalled_plugins=$(diff --changed-group-format='%<' --unchanged-group-format='' \
  <(echo $plugins_to_install) \
  <(echo $installed_plugins)
)

for p in $uninstalled_plugins; do
  asdf plugin-add "$p"
done;

export JAVA_HOME=$(asdf where java)
